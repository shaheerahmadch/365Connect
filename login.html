<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaheer Ahmad Events</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url(https://kpmglearningmalta.com/wp-content/uploads/2022/03/slide28.png);
            margin: 0;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;

            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .login-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            width: 300px;
            padding: 20px;
            text-align: center;
        }

        .login-container h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .login-container input[type="text"],
        .login-container input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px -15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .login-container button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }

        .login-container button:hover {
            background-color: #0056b3;
        }

        .login-container p {
            margin-top: 10px;
            color: #888;
        }

        .in-put {
            height: 30px;
        }

        .bntn {
            height: 40px;
            width: 100px;
        }

        .alert {
            background-color: coral;
            width: 100%;
            padding: 10px;
            margin-left: -10px;
            margin-top: 10px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="loading" id="loading">Loading&#8230;</div>
    <div class="login-container">
        <h2>Continue with Email</h2>
        <hr><br>
        <input class="in-put" type="text" placeholder="Email" id="email"><br><br><br>
        <button class="bntn" onclick="submit()">Continue</button>
        <div class="message" id="message">
        </div>
    </div>
</body>
<script>
    const email = sessionStorage.getItem("email");
    const fullname = sessionStorage.getItem("name");
    if(email != '' && fullname != '' && email !=  null && fullname != null ){
        let url = "./my-registrations.html";
        window.location.href = url;
    }
    document.getElementById("loading").style.display = "none";
    function submit() {
        
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        if (document.getElementById("email").value == '')
            showError("Email is required")
        if (document.getElementById("email").value != '') {
            document.getElementById("loading").style.display = "block";
            var myHeaders = new Headers();
            myHeaders.append("email", document.getElementById("email").value);

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch("https://prod-51.southeastasia.logic.azure.com:443/workflows/4ec99569bce8405997dfbf65e7c8332c/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=0YInkgvREn7KdFoUwWU9RNovgiX3cGnu24AQ0Ho-GT0", requestOptions)
                .then(response => {
                    if (response.status === 200) {
                        // Parse the response body as JSON
                        return response.json();
                    } else {
                        // Handle other response statuses or errors here
                        showError("Account not found");
                        document.getElementById("loading").style.display = "none";
                        return null;
                    }
                })
                .then(data => {
                    // Check if data is not null
                    if (data !== null) {
                        // Extract the necessary information from the data
                        const email = data.emailaddress1;
                        const name = data.fullname;

                        // Construct the URL with query parameters
                        const url = `./login-varify.html`;
                        sessionStorage.setItem("email", email);
                        sessionStorage.setItem("name",name);
                        // Navigate to the desired URL
                        window.location.href = url;
                    }
                })
                .catch(error => {
                    showError("Account not found");
                    document.getElementById("loading").style.display = "none";
                });

            }
            //window.location.replace("./registrations.html?email="+document.getElementById("email").value)
        }
        function showError(alert, alertType) {
            var message = document.getElementById("message");
            var messagetext = document.createElement("div");
            messagetext.classList.add("alert")
            messagetext.classList.add("alert-" + alertType)
            messagetext.textContent = alert;
            message.appendChild(messagetext);
        }
</script>

</html>