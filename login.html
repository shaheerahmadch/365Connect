<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="365Connect is a community dedicated to promoting and advancing the adoption of Microsoft D365 and Power Platform technologies. Our primary goal is to foster a supportive environment where individuals can learn, teach, and collaborate on all things related to these powerful tools. Whether you're an experienced user or just starting out, we welcome members from any part of the globe to join us in our mission to promote and develop this community.">
    <meta name="author" content="Shaheer Ahmad">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900"
        rel="stylesheet">


    <!-- Bootstrap core CSS -->

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-grad-school.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/lightbox.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | 365Connect Community</title>
    <link rel="stylesheet" href="styles.css">

    <script src="vendor/jquery/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/jquery-3.3.1.slim.min.js">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #333; /* You can change the background color as needed */
        color: #fff; /* You can change the text color as needed */
        text-align: center;
        padding: 10px 0;
    }
        body {
            font-family: Arial, sans-serif;
            background: url(https://kpmglearningmalta.com/wp-content/uploads/2022/03/slide28.png);
            margin: 0;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;

            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .login-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            width: 300px;
            padding: 20px;
            text-align: center;
        }

        .login-container h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .login-container input[type="text"],
        .login-container input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px -15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .login-container button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }

        .login-container button:hover {
            background-color: #0056b3;
        }

        .login-container p {
            margin-top: 10px;
            color: #888;
        }

        .in-put {
            height: 30px;
        }

        .bntn {
            height: 40px;
            width: 100px;
        }

        .alert {
            background-color: coral;
            width: 100%;
            padding: 10px;
            margin-left: -10px;
            margin-top: 10px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <header class="main-header clearfix" role="header">
        <div class="logo">
            <img style="height: 50px; margin-right: 20px;;" src="./favicon.ico">
            <a href="#" style="text-decoration: none; font-size: 29px !important;"><em></em><span
                    style="color: #feb70c;">3</span><span style="color: #5ea904;">6</span><span
                    style="color: #04a0ed;">5</span><span style="color: white;">C</span><span
                    style="text-transform: lowercase;">onnect</span></a><!--#ce392c;-->
        </div>
        <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
        <nav id="menu" class="main-nav" role="navigation">
            <ul class="main-menu">
                <li class="active"><a style="text-decoration: none !important;" href="#">Login</a></li>
                <li><a style="text-decoration: none !important;" href="./index.html">Home</a></li>
                <li><a style="text-decoration: none !important;" href="./events.html" class="external">Events</a></li>
            </ul>
        </nav>
    </header>
    <div class="loading" id="loading">Loading&#8230;</div>
    <div class="login-container">
        <h2>Continue with Email</h2>
        <hr><br>
        <input class="in-put" type="text" placeholder="Email" id="email"><br><br><br>
        <button class="bntn" onclick="submit()">Continue</button>
        <div class="message" id="message">
        </div>
    </div>
    
</body>
<script>
    const email = sessionStorage.getItem("email");
    const fullname = sessionStorage.getItem("name");
    if(sessionStorage.getItem("name") == null || sessionStorage.getItem("email") == null || sessionStorage.getItem("email") == 'null' || sessionStorage.getItem("name") == 'null'|| sessionStorage.getItem("email") == '' || sessionStorage.getItem("name") == ''){
        console.log("not signed in")
    }
    else{
        let url = "./my-profile.html";
        window.location.href = url;
    }
    document.getElementById("loading").style.display = "none";
    function submit() {
        
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        if (document.getElementById("email").value == '')
            showError("Email is required")
        if (document.getElementById("email").value != '') {
            document.getElementById("loading").style.display = "block";
            var myHeaders = new Headers();
            myHeaders.append("email", document.getElementById("email").value);

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch("https://prod-51.southeastasia.logic.azure.com:443/workflows/4ec99569bce8405997dfbf65e7c8332c/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=0YInkgvREn7KdFoUwWU9RNovgiX3cGnu24AQ0Ho-GT0", requestOptions)
                .then(response => {
                    if (response.status === 200) {
                        // Parse the response body as JSON
                        return response.json();
                    } else {
                        // Handle other response statuses or errors here
                        showError("Account not found");
                        document.getElementById("loading").style.display = "none";
                        return null;
                    }
                })
                .then(data => {
                    // Check if data is not null
                    if (data !== null) {
                        // Extract the necessary information from the data
                        const email = data.emailaddress1;
                        const name = data.fullname;
                        const firstname = data.firstname;
                        const lastname = data.lastname;
                        const image = data.entityimage;
                        console.log(image)

                        // Construct the URL with query parameters
                        const url = `./login-varify.html`;
                        sessionStorage.setItem("email1", email);
                        sessionStorage.setItem("name1",name);
                        sessionStorage.setItem("firstname1",firstname);
                        sessionStorage.setItem("lastname1",lastname);
                        sessionStorage.setItem("image1",image);
                        // Navigate to the desired URL
                        window.location.href = url;
                    }
                })
                .catch(error => {
                    showError("Account not found");
                    document.getElementById("loading").style.display = "none";
                });

            }
            //window.location.replace("./registrations.html?email="+document.getElementById("email").value)
        }
        function showError(alert, alertType) {
            var message = document.getElementById("message");
            var messagetext = document.createElement("div");
            messagetext.classList.add("alert")
            messagetext.classList.add("alert-" + alertType)
            messagetext.textContent = alert;
            message.appendChild(messagetext);
        }
</script>

</html>