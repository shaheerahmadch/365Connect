<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaheer Ahmad Events</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url(https://kpmglearningmalta.com/wp-content/uploads/2022/03/slide28.png);
            margin: 0;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;

            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .login-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            width: 300px;
            padding: 20px;
            text-align: center;
        }

        .login-container h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .login-container input[type="text"],
        .login-container input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px -15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .login-container button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }

        .login-container button:hover {
            background-color: #0056b3;
        }

        .login-container p {
            margin-top: 10px;
            color: #888;
        }

        .in-put {
            height: 30px;
        }

        .bntn {
            height: 40px;
            width: 100px;
        }

        .alert {
            background-color: coral;
            width: 100%;
            padding: 10px;
            margin-left: -10px;
            margin-top: 10px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="loading" id="loading">Loading&#8230;</div>
    <div class="login-container">
        <div id="login-container"></div>
        <input class="in-put" type="text" placeholder="Varification Code" id="code"><br><br><br>
        <button class="bntn" onclick="submit()">Continue</button>
        <div class="message" id="message">
        </div>
    </div>
</body>
<script>
    const url_string = window.location.href;
    const url = new URL(url_string);
    //const email = url.searchParams.get("email");
    //const fullname = url.searchParams.get("name");
    const email = sessionStorage.getItem("email");
    const fullname = sessionStorage.getItem("name");
    const heading = document.getElementById("login-container");
    const text = document.createElement("input");
    text.id = "email"
    const hr = document.createElement("hr");
    const text2 = document.createElement("h2");
    const text3 = document.createElement("p");
    text3.innerText = "Varification code has been sent to your email."
    text.classList.add("in-put");
    text.placeholder = "Email";
    text.type = "text";
    text.value = email;
    text.disabled = true;
    text2.textContent = "Welcome, " + fullname.split(' ')[0];
    heading.appendChild(text2);
    heading.appendChild(hr);
    heading.appendChild(text3)
    heading.appendChild(text);
    document.getElementById("loading").style.display = "none";
    function submit() {
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        if (document.getElementById("code").value == '')
            showError("Code is required")
        if (document.getElementById("code").value != '') {
            document.getElementById("loading").style.display = "block";
            var myHeaders = new Headers();
            myHeaders.append("email", document.getElementById("email").value);
            myHeaders.append("code", document.getElementById("code").value);

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch("https://prod-23.southeastasia.logic.azure.com:443/workflows/eceae0b4ffee413687edf494b289f51e/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=JDu_0tsKqEq-Nqa2cOCT4p_Q1G6W7JN0fOeKgwpQ6-Q", requestOptions)
                .then(response => {
                    if (response.status === 200) {
                        // Construct the URL to navigate to
                        const url = "./my-registrations.html";

                        // Navigate to the desired URL
                        window.location.href = url;
                    } else {
                        // Handle other response statuses or errors here
                        showError("Code incorrect or expired");
                        document.getElementById("loading").style.display = "none";
                    }
                })
                .catch(error => {
                    // Handle other errors here
                    showError("Code incorrect or expired");
                    document.getElementById("loading").style.display = "none";
                });





        }
        //window.location.replace("./registrations.html?email="+document.getElementById("email").value)
    }
    function showError(alert, alertType) {
        var message = document.getElementById("message");
        var messagetext = document.createElement("div");
        messagetext.classList.add("alert")
        messagetext.classList.add("alert-" + alertType)
        messagetext.textContent = alert;
        message.appendChild(messagetext);
    }
</script>

</html>